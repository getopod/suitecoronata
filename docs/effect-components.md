# Suitecoronata Effect Components (Reusable Mechanics)

This doc breaks Suitecoronata’s effect logic into small, reusable “components”. Each component is a *mechanic* you can mix-and-match to implement new effects (including in **claudecoronata**).

Conventions:
- Component IDs are stable and can be referenced from other docs.
- Each component lists the primary hook(s) where it lives.
- “Examples” reference Suitecoronata effect IDs found in `data/effects.ts`.

---

## SC-MOVE-ALLOW-DENY — Move rule override

**Hook(s):** `canMove`

**What it is:** A predicate that can *allow* an otherwise-illegal move, or *deny* an otherwise-legal move.

**Typical parameters:**
- Target pile type (`tableau` vs `foundation`)
- Rank relationship (next lower / ace high / ±1 etc.)
- Suit/color relationship (alternate colors / ignore colors)
- Stack size (single-card only)

**Examples:** `bait_switch`, `blacksmith`, `stolen_valor`, `fog_of_war`, `excommunication`, `stranglehold`, `malocchio`

---

## SC-ACTIVATE-MUTATION — One-time activation / pickup mutation

**Hook(s):** `onActivate`

**What it is:** A one-time mutation when an effect becomes active (buy/pickup/use). Typically used to:
- add/remove other effects,
- grant charges/resources,
- mutate board layout (add foundations/tableaus),
- initialize per-effect counters in `effectState`.

**Examples:** (SuiteCoronata uses `onActivate` in several effects in `data/effects.ts`.)

---

## SC-DEACTIVATE-CLEANUP — Toggle-off / removal cleanup

**Hook(s):** `onDeactivate` (SuiteCoronata doesn’t currently expose this hook, but ClaudeCoronata does.)

**What it is:** A cleanup mechanic for toggle/temporary effects (remove flags, clear counters, restore rules).

**Examples:** (Primarily a ClaudeCoronata concern.)

---

## SC-MOVE-REDIRECT — Move interception / stumble

**Hook(s):** `interceptMove`

**What it is:** Mutates a pending move *before* it executes (most often changing `target`).

**Common patterns:**
- Redirect to a random valid adjacent tableau
- Redirect to a “nearest” pile by some heuristic

**Examples:** `herding_cats`

---

## SC-POSTMOVE-MUTATION — After-move state mutation

**Hook(s):** `onMoveComplete`

**What it is:** Applies game-state changes after a move finishes.

**Common patterns:**
- Score/coin adjustments tied to the move
- Pile mutations (shuffle, remove cards, re-deal)
- Trigger minigames / side effects

**Examples:** `mulligan`, `death_dishonor`, `hyperfixation`, `mandatory_minimum`, `schizophrenia`, `deregulation`

---

## SC-PERIODIC-EVERY-N-MOVES — Periodic trigger gate

**Hook(s):** `onMoveComplete` (guarded by `moves % N === 0`)

**What it is:** A gating helper that runs some payload every $N$ moves.

**Examples:**
- Every 5 moves: `mulligan`, `schizophrenia`
- Every 12 moves: `deregulation`

---

## SC-DECK-CYCLE-EVENT — Detect “deck cycle / reshuffle”

**Hook(s):** `onMoveComplete`

**What it is:** A reusable *event detector* for “deck cycle” moments (Suitecoronata currently uses `context.source === 'waste' && context.target === 'deck'`).

**Examples:** `death_dishonor`, `hyperfixation`, `mandatory_minimum`

---

## SC-BOARD-REDEAL-SHUFFLE — Collect → reset → shuffle → redeal

**Hook(s):** `onMoveComplete`

**What it is:** A full-board mutation that:
1) collects all cards from all piles,
2) resets some fields (often `faceUp=false`),
3) shuffles,
4) re-deals to the standard layout.

**Examples:** `mulligan`

---

## SC-SUBSET-SHUFFLE — Shuffle only a subset of cards

**Hook(s):** `onMoveComplete`

**What it is:** Shuffle just a subset (e.g., face-down tableau cards) while preserving the rest.

**Examples:** `deregulation`

---

## SC-CARD-REROLL-RANK — Randomize ranks (usually on a periodic gate)

**Hook(s):** `onMoveComplete`

**What it is:** A mutation that changes `rank` for some set of cards (commonly face-up cards).

**Examples:** `schizophrenia`

---

## SC-SCORE-DELTA-MOD — Score delta modifier

**Hook(s):** `calculateScore`

**What it is:** Adjusts the score delta generated by a move.

**Common patterns:**
- Flat bonus/penalty by suit
- Multipliers by move type (foundation vs tableau)
- “Zero out” scoring for specific actions

**Examples:** `stolen_valor`, `broken_heart`, `fog_of_war`, `analysis_paralysis`, `delusions_grandeur`, `malocchio`

---

## SC-COIN-DELTA-MOD — Coin delta modifier

**Hook(s):** `calculateCoinTransaction`

**What it is:** Adjusts the coin delta generated by a move.

**Common patterns:**
- Discard costs
- Foundation-play bonuses
- Completion bonuses

**Examples:** `creative_accounting`, `hyperfixation`, `analysis_paralysis`

---

## SC-FOUNDATION-COMPLETE-DETECT — Detect a foundation completion

**Hook(s):** typically `calculateCoinTransaction` (via pile length checks)

**What it is:** Detect “this move completes a foundation” using:
- target is foundation, and
- `currentLen + movedCards === 13`.

**Examples:** `creative_accounting`

---

## SC-VISUAL-MASK — Visual-only card transforms

**Hook(s):** `transformCardVisual`

**What it is:** Change what the player sees without changing actual card identity/state.

**Common patterns:**
- Hide rank (set to sentinel like `-1`)
- Force face-up for specific piles

**Examples:** `hostile_takeover`, `vagrant`

---

## SC-CARD-MORPH-ON-PLAY — Change card identity after placement

**Hook(s):** `onMoveComplete`

**What it is:** After placing cards, mutate the placed card(s) to match some computed suit/rank.

**Examples:** `sycophant`

---

## SC-RANDOMNESS-INJECTION — Deterministic RNG plumbing

**Hook(s):** any (enables deterministic behavior)

**What it is:** A pattern to make random effects testable/replayable by injecting a seeded RNG.

**Suitecoronata implementation:** `data/effects.ts` exports `setEffectsRng` / `resetEffectsRng` (overrides `Math.random`).

**Examples (randomized effects):** `malocchio`, `herding_cats`, `mandatory_minimum`, `schizophrenia`, `deregulation`, etc.

---

## SC-EFFECT-STATE-COUNTERS — Per-effect counters/state

**Hook(s):** usually `onMoveComplete` / `onActivate`

**What it is:** Store per-effect state in `gameState.effectState[effectId]` (or similar) to track counters, toggles, “already triggered this encounter”, etc.

**Examples:** Many effects in `data/effects.ts` use `effectState` for gating.

---

## How to use these components in ClaudeCoronata

At a high level:
- Map Suitecoronata `canMove` → ClaudeCoronata `canMove` (same concept).
- Map Suitecoronata `interceptMove` → ClaudeCoronata `interceptMove` (same concept).
- Map Suitecoronata “deck cycle detection” (post-move) → ClaudeCoronata `onShuffle` / `onDraw` / `onDiscard` when available.
- Prefer deterministic RNG patterns for any “% chance” effect.
